@model IEnumerable<InventorySystem.ViewModels.AgingReportItem>

@if (Model.Any())
{
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead class="table-dark">
                <tr>
                    <th>Invoice #</th>
                    <th>Customer</th>
                    <th>Sale Date</th>
                    <th>Due Date</th>
                    <th>Days Old</th>
                    <th class="text-end">Amount</th>
                    <th>Status</th>
                    <th class="text-center">Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.OrderByDescending(i => i.Amount))
                {
                    <tr>
                        <td>
                            <a href="/Sales/Details/@item.SaleId" class="text-decoration-none fw-bold">
                                @item.SaleNumber
                            </a>
                        </td>
                        <td>
                            <a href="/Customers/Details/@item.CustomerId" class="text-decoration-none">
                                @item.CustomerName
                            </a>
                        </td>
                        <td>@item.SaleDate.ToString("MM/dd/yyyy")</td>
                        <td>@item.DueDate.ToString("MM/dd/yyyy")</td>
                        <td>
                            <span class="badge bg-@(item.DaysOld <= 0 ? "success" : item.DaysOld <= 30 ? "warning" : item.DaysOld <= 60 ? "orange" : "danger")">
                                @item.DaysOld
                            </span>
                        </td>
                        <td class="text-end">
                            <strong>@item.Amount.ToString("C")</strong>
                        </td>
                        <td>
                            <span class="badge bg-@(item.PaymentStatus switch {
                                InventorySystem.Models.Enums.PaymentStatus.Pending => "warning",
                                InventorySystem.Models.Enums.PaymentStatus.Overdue => "danger",
                                InventorySystem.Models.Enums.PaymentStatus.PartiallyPaid => "info",
                                _ => "secondary"
                            })">
                                @item.PaymentStatus
                            </span>
                        </td>
                        <td class="text-center">
                            <div class="btn-group btn-group-sm">
                                <a href="/Sales/InvoiceReport?saleId=@item.SaleId" 
                                   class="btn btn-outline-primary" 
                                   title="View Invoice">
                                    <i class="fas fa-file-invoice"></i>
                                </a>
                                <a href="/Sales/Details/@item.SaleId" 
                                   class="btn btn-outline-info" 
                                   title="Sale Details">
                                    <i class="fas fa-eye"></i>
                                </a>
                                <button class="btn btn-outline-success" 
                                        onclick="recordPayment(@item.SaleId, '@item.SaleNumber', @item.Amount)" 
                                        title="Record Payment">
                                    <i class="fas fa-dollar-sign"></i>
                                </button>
                                <button class="btn btn-outline-warning" 
                                        onclick="sendReminder(@item.CustomerId, '@item.CustomerName', '@item.SaleNumber')" 
                                        title="Send Reminder">
                                    <i class="fas fa-envelope"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
            <tfoot class="table-secondary">
                <tr>
                    <th colspan="5" class="text-end">Total:</th>
                    <th class="text-end">@Model.Sum(i => i.Amount).ToString("C")</th>
                    <th colspan="2"></th>
                </tr>
            </tfoot>
        </table>
    </div>
}
else
{
    <div class="text-center py-4">
        <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
        <h5 class="text-muted">No invoices in this aging bucket</h5>
        <p class="text-muted">This is good news! All invoices in this category are up to date.</p>
    </div>
}

<script>
function recordPayment(saleId, saleNumber, amount) {
    if (confirm(`Record payment for Invoice ${saleNumber} (${amount.toLocaleString('en-US', {style: 'currency', currency: 'USD'})})?`)) {
        window.location.href = `/Sales/Details/${saleId}#recordPaymentModal`;
    }
}

function sendReminder(customerId, customerName, saleNumber) {
    if (confirm(`Send payment reminder to ${customerName} for Invoice ${saleNumber}?`)) {
        // In a real implementation, this would trigger an email or log a collection action
        alert(`Payment reminder sent to ${customerName}`);
    }
}
</script>

<style>
.badge.bg-orange {
    background-color: #fd7e14 !important;
}

.table th, .table td {
    vertical-align: middle;
}

.btn-group-sm .btn {
    padding: 0.25rem 0.4rem;
    font-size: 0.75rem;
}

.table-hover tbody tr:hover {
    background-color: rgba(0, 123, 255, 0.075);
}
</style>