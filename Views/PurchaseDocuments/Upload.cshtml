@model InventorySystem.ViewModels.PurchaseDocumentUploadViewModel
@{
    ViewData["Title"] = "Upload Purchase Document";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="fas fa-upload"></i> Upload Purchase Document</h1>
    <a href="/Purchases/Edit/@Model.PurchaseId" class="btn btn-outline-secondary">
        <i class="fas fa-arrow-left"></i> Back to Edit Purchase
    </a>
</div>

<div class="alert alert-info">
    <h6><i class="fas fa-info-circle"></i> Uploading document for:</h6>
    <strong>Purchase:</strong> @Model.PurchaseDetails<br>
    <strong>Item:</strong> @Model.ItemPartNumber
</div>

@if (!ViewData.ModelState.IsValid)
{
    <div class="alert alert-danger">
        <h6><i class="fas fa-exclamation-triangle"></i> Please fix the following errors:</h6>
        <div asp-validation-summary="All" class="text-danger"></div>
    </div>
}

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-file-upload"></i> Document Upload</h5>
            </div>
            <div class="card-body">
                <form asp-action="Upload" method="post" enctype="multipart/form-data">
                    @Html.HiddenFor(m => m.PurchaseId)
                    @Html.HiddenFor(m => m.PurchaseDetails)
                    @Html.HiddenFor(m => m.ItemPartNumber)

                    <div class="mb-3">
                        <label asp-for="DocumentFile" class="form-label">
                            <i class="fas fa-file"></i> Select File <span class="text-danger">*</span>
                        </label>
                        <input asp-for="DocumentFile" class="form-control" type="file" 
                               accept=".pdf,.jpg,.jpeg,.png,.gif,.bmp,.tiff,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.rtf,.zip,.rar,.7z">
                        <span asp-validation-for="DocumentFile" class="text-danger"></span>
                        <div class="form-text">
                            <i class="fas fa-info-circle"></i>
                            Supported: @Model.AllowedFileTypesDisplay (Max: @Model.MaxFileSizeDisplay)
                        </div>
                    </div>

                    <div class="mb-3">
                        <label asp-for="DocumentName" class="form-label">
                            <i class="fas fa-tag"></i> Document Name <span class="text-danger">*</span>
                        </label>
                        <input asp-for="DocumentName" class="form-control" placeholder="Enter a descriptive name for this document">
                        <span asp-validation-for="DocumentName" class="text-danger"></span>
                    </div>

                    <div class="mb-3">
                        <label asp-for="DocumentType" class="form-label">
                            <i class="fas fa-folder-open"></i> Document Type <span class="text-danger">*</span>
                        </label>
                        <select asp-for="DocumentType" class="form-select">
                            <option value="">-- Select Document Type --</option>
                            @foreach (var docType in Model.AvailableDocumentTypes)
                            {
                                <option value="@docType">@docType</option>
                            }
                        </select>
                        <span asp-validation-for="DocumentType" class="text-danger"></span>
                    </div>

                    <div class="mb-3">
                        <label asp-for="Description" class="form-label">
                            <i class="fas fa-comment"></i> Description
                        </label>
                        <textarea asp-for="Description" class="form-control" rows="3" 
                                  placeholder="Optional description or notes about this document"></textarea>
                        <span asp-validation-for="Description" class="text-danger"></span>
                    </div>

                    <div class="d-flex justify-content-end">
                        <a href="/Purchases/Edit/@Model.PurchaseId" class="btn btn-outline-secondary me-2">
                            <i class="fas fa-times"></i> Cancel
                        </a>
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-upload"></i> Upload Document
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-question-circle"></i> Document Types</h5>
            </div>
            <div class="card-body">
                <h6>Common Purchase Documents:</h6>
                <ul class="list-unstyled">
                    <li><i class="fas fa-file-invoice text-danger"></i> <strong>Invoice</strong> - Final bill for payment</li>
                    <li><i class="fas fa-file-contract text-primary"></i> <strong>Purchase Order</strong> - Official order document</li>
                    <li><i class="fas fa-receipt text-success"></i> <strong>Receipt</strong> - Proof of payment</li>
                    <li><i class="fas fa-shipping-fast text-info"></i> <strong>Packing Slip</strong> - Shipping contents list</li>
                    <li><i class="fas fa-truck text-warning"></i> <strong>Delivery Note</strong> - Delivery confirmation</li>
                    <li><i class="fas fa-file-alt text-secondary"></i> <strong>Quote</strong> - Price quotation</li>
                </ul>
            </div>
        </div>

        <div class="card mt-3">
            <div class="card-header">
                <h5><i class="fas fa-upload"></i> Upload Guidelines</h5>
            </div>
            <div class="card-body">
                <ul class="list-unstyled">
                    <li><i class="fas fa-check text-success"></i> Use descriptive file names</li>
                    <li><i class="fas fa-check text-success"></i> Choose the correct document type</li>
                    <li><i class="fas fa-check text-success"></i> Add descriptions for clarity</li>
                    <li><i class="fas fa-check text-success"></i> Ensure documents are legible</li>
                    <li><i class="fas fa-exclamation-triangle text-warning"></i> Max file size: @Model.MaxFileSizeDisplay</li>
                </ul>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Auto-populate document name based on file selection
            const documentFileInput = document.getElementById('DocumentFile');
            const documentNameInput = document.getElementById('DocumentName');
            const documentTypeSelect = document.getElementById('DocumentType');
            
            documentFileInput.addEventListener('change', function() {
                const file = this.files[0];
                if (file && !documentNameInput.value) {
                    const fileName = file.name;
                    const nameWithoutExtension = fileName.substring(0, fileName.lastIndexOf('.'));
                    documentNameInput.value = nameWithoutExtension;
                }
            });

            // Auto-select document type based on file extension
            documentFileInput.addEventListener('change', function() {
                const file = this.files[0];
                if (file && !documentTypeSelect.value) {
                    const extension = file.name.split('.').pop().toLowerCase();
                    let suggestedType = '';

                    switch(extension) {
                        case 'pdf':
                            if (file.name.toLowerCase().includes('invoice')) {
                                suggestedType = 'Invoice';
                            } else if (file.name.toLowerCase().includes('receipt')) {
                                suggestedType = 'Receipt';
                            } else if (file.name.toLowerCase().includes('quote')) {
                                suggestedType = 'Quote';
                            }
                            break;
                        case 'jpg':
                        case 'jpeg':
                        case 'png':
                            suggestedType = 'Receipt';
                            break;
                    }

                    if (suggestedType) {
                        documentTypeSelect.value = suggestedType;
                    }
                }
            });

            // Form validation
            document.querySelector('form').addEventListener('submit', function(e) {
                const file = documentFileInput.files[0];
                const documentName = documentNameInput.value;
                const documentType = documentTypeSelect.value;

                if (!file) {
                    alert('Please select a file to upload.');
                    e.preventDefault();
                    return false;
                }

                if (!documentName.trim()) {
                    alert('Please enter a document name.');
                    e.preventDefault();
                    return false;
                }

                if (!documentType) {
                    alert('Please select a document type.');
                    e.preventDefault();
                    return false;
                }

                // Show loading state
                const submitButton = this.querySelector('button[type="submit"]');
                submitButton.disabled = true;
                submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Uploading...';
            });
        });
    </script>

    <style>
        .card {
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        }
        
        .alert-info {
            border-left: 4px solid #0dcaf0;
        }
        
        .form-text {
            font-size: 0.875em;
        }
        
        .list-unstyled li {
            margin-bottom: 0.5rem;
        }
    </style>
}