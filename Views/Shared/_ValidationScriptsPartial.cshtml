@*
    This partial view includes the scripts required for client-side validation in ASP.NET Core.
    It should be included in views that use validation, typically with:
    @section Scripts {
        @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    }
*@

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/jquery.validate.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validation-unobtrusive/3.2.12/jquery.validate.unobtrusive.min.js"></script>

<script>
    // Additional validation configuration
    $.validator.setDefaults({
        highlight: function (element) {
            $(element).addClass('is-invalid').removeClass('is-valid');
        },
        unhighlight: function (element) {
            $(element).removeClass('is-invalid').addClass('is-valid');
        },
        errorElement: 'div',
        errorClass: 'invalid-feedback',
        errorPlacement: function (error, element) {
            if (element.parent('.input-group').length) {
                error.insertAfter(element.parent());
            } else {
                error.insertAfter(element);
            }
        }
    });

    // Custom validation methods can be added here
    $.validator.addMethod("greaterThanZero", function(value, element) {
        return this.optional(element) || (parseFloat(value) > 0);
    }, "Value must be greater than zero.");

    $.validator.addMethod("positiveInteger", function(value, element) {
        return this.optional(element) || (Number.isInteger(Number(value)) && Number(value) > 0);
    }, "Value must be a positive integer.");

    // File size validation method
    $.validator.addMethod("filesize", function(value, element, param) {
        if (this.optional(element)) {
            return true;
        }
        if (element.files && element.files.length > 0) {
            return element.files[0].size <= param;
        }
        return true;
    }, "File size must be less than {0} bytes.");

    // File type validation method
    $.validator.addMethod("filetype", function(value, element, param) {
        if (this.optional(element)) {
            return true;
        }
        if (element.files && element.files.length > 0) {
            var allowedTypes = param.split(',');
            var fileType = element.files[0].type.toLowerCase();
            return allowedTypes.indexOf(fileType) !== -1;
        }
        return true;
    }, "Please select a valid file type.");

    // Form validation enhancement
    $(document).ready(function() {
        // Add Bootstrap validation classes to all forms with validation
        $('form').each(function() {
            var form = $(this);
            if (form.data('validator') || form.data('unobtrusiveValidation')) {
                form.find('input, select, textarea').on('blur', function() {
                    if ($(this).valid()) {
                        $(this).removeClass('is-invalid').addClass('is-valid');
                    } else {
                        $(this).removeClass('is-valid').addClass('is-invalid');
                    }
                });
            }
        });

        // Handle form submission with validation
        $('form[data-ajax="false"], form:not([data-ajax])').on('submit', function(e) {
            var form = $(this);
            if (form.data('validator') && !form.valid()) {
                e.preventDefault();
                
                // Focus on first invalid field
                var firstError = form.find('.is-invalid').first();
                if (firstError.length) {
                    firstError.focus();
                    
                    // Scroll to the error if it's not visible
                    $('html, body').animate({
                        scrollTop: firstError.offset().top - 100
                    }, 500);
                }
                
                // Show a general error message
                if (!$('.validation-summary-errors').length) {
                    form.prepend('<div class="alert alert-danger validation-summary-errors"><ul><li>Please correct the errors below and try again.</li></ul></div>');
                }
            }
        });

        // Auto-hide success messages after 5 seconds
        $('.alert-success').delay(5000).fadeOut('slow');
    });
</script>